<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="F4tty" />
  <meta name="description" content="" />
  
  
  <title>
    
      域信息收集 
      
      
      |
    
     F4tty
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/img/favicon.ico">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/img/avatar.jpg" alt="">
      
    </a>
    <div class="nickname"><a href="/">F4tty</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">主页</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">分类</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">友链</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">关于我</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">域信息收集</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
          2022-09-12 00:00:00
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="标签"></i>
                
                <span class="span--tag mr-8">
                  <a href="/tags/%E5%86%85%E7%BD%91/" title="内网">
                    #内网
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h1 id="域信息收集"><a href="#域信息收集" class="headerlink" title="域信息收集"></a>域信息收集</h1><h2 id="什么是域环境"><a href="#什么是域环境" class="headerlink" title="什么是域环境"></a>什么是域环境</h2><p>将网络中多台计算机逻辑上组织到一起，进行集中管理，并区别于工作组的逻辑环境叫做域，域是组织与存储资源的核心管理单元，在域中，至少有一台域控制器(DC)，域控制器(DC)中保存着整个域的用户帐号和安全数据库。</p>
<p>0x01</p>
<p>一个具有一定规模的企业，每天都可能面临员工入职和离职，因此网络管理部门经常需要对域成员主机进行格式化消除磁盘的文件，然后重装系统及软件，以提供给新员工使用；因此，为了便于后期交接，大多网络管理员会做好一个系统镜像盘，统一安装所有的电脑，并且在安装的时候设置惯用、甚至统一的密码。</p>
<p>0x02</p>
<p>因此，域中的计算机本地管理员账号，极有可能能够登陆域中较多的计算机，本地管理员的密码在服务器上后期修改的概率，远低于在个人办公电脑上的概率，而域用户权限是较低的，是无法在域成员主机上安装软件的，这将会发生下面的一幕：</p>
<p>某个域用户需要使用viso软件进行绘图操作，于是联系网络管理员进行安装，网络管理员采用域管理员身份登录了域成员主机，并帮助其安装了viso软件，于是这个有计算机基础的员工，切换身份登录到了本地计算机的管理员，后执行mimikatz，从内存当中抓取了域管理员的密码，便成功的控制了整个域。</p>
<p>0x03</p>
<p>因此，域渗透的思路就是：通过域成员主机，定位出域控制器IP及域管理员账号，利用域成员主机作为跳板，扩大渗透范围，利用域管理员可以登陆域中任何成员主机的特性，定位出域管理员登陆过的主机IP，设法从域成员主机内存中dump出域管理员密码，进而拿下域控制器、渗透整个内网。</p>
<p>当前机器角色的判断–个人PC&amp;文件服务器&amp;邮件服务器等<br>当前机器网络环境判断–局域网&amp;工作组&amp;域环境<br>当前机器角色功能判断–任务&amp;端口&amp;服务&amp;密码&amp;漏洞&amp;配置等</p>
<h2 id="常规信息类收集-应用-amp-服务-amp-权限等"><a href="#常规信息类收集-应用-amp-服务-amp-权限等" class="headerlink" title="常规信息类收集-应用&amp;服务&amp;权限等"></a>常规信息类收集-应用&amp;服务&amp;权限等</h2><p><img src="/posts/225ec2c9/eetivl27t4uy4YiieUguOQ.png" alt="eetivl27t4uy4YiieUguOQ"><br><img src="/posts/225ec2c9/9dxsuZWjbEPQMl2vx1HSBA.png" alt="9dxsuZWjbEPQMl2vx1HSBA"></p>
<p>更多其他收集见上图命令表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">systeminfo #详细信息</span><br><span class="line">netstat -ano #端口列表</span><br><span class="line">route print #路由表</span><br><span class="line">net start #启动服务</span><br><span class="line">tasklist #进程列表</span><br><span class="line">schtasks #计划任务</span><br><span class="line">ipconfig /all #判断存在域</span><br><span class="line">net view /domain #判断存在域</span><br><span class="line">net time /domain #判断主域</span><br><span class="line">netstat -ano #当前网络端口开放</span><br><span class="line">nslookup 域名 #追踪来源地址</span><br><span class="line">wmic service list brief #查询本机服务</span><br><span class="line">net config workstation  #查询当前登录域及登录用户信息</span><br><span class="line">wmic startup get command,caption #查看已启动的程序信息</span><br></pre></td></tr></table></figure>

<h2 id="架构信息类收集-网络-amp-用户-amp-域控等"><a href="#架构信息类收集-网络-amp-用户-amp-域控等" class="headerlink" title="架构信息类收集-网络&amp;用户&amp;域控等"></a>架构信息类收集-网络&amp;用户&amp;域控等</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">net view /domain #查询域列表</span><br><span class="line">net time/domain #从域控查询时间，若当前用户是域用户会从域控返回当前时间，亦用来判 断主域，主域一般用做时间服务</span><br><span class="line">net localgroup administrators #本机管理员【通常含有域用户】</span><br><span class="line">net user /domain #查询域用户(当前域)</span><br><span class="line">net group /domain #查询域工作组</span><br><span class="line">net group &quot;domain computers&quot; /domain #查看加入域的所有计算机名</span><br><span class="line">net group &quot;domain admins&quot; /domain #查询域管理员用户组和域管用户</span><br><span class="line">net localgroup administrators /domain #查看域管理员</span><br><span class="line">net group &quot;domain controllers&quot; /domain #查看域控</span><br><span class="line">net accounts /domain #查看域密码策略</span><br></pre></td></tr></table></figure>

<h2 id="关键信息类收集-密码-amp-凭据-amp-口令等"><a href="#关键信息类收集-密码-amp-凭据-amp-口令等" class="headerlink" title="关键信息类收集-密码&amp;凭据&amp;口令等"></a>关键信息类收集-密码&amp;凭据&amp;口令等</h2><p>旨在收集各种密文，明文，口令等，为后续横向渗透做好测试准备<br>计算机用户HASH，明文获取-mimikatz(win)，mimipenguin(linux)<br>计算机各种协议服务口令获取-LaZagne(all)，XenArmor(win)，CS插件</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz/">https://github.com/gentilkiwi/mimikatz/</a><br><a target="_blank" rel="noopener" href="https://github.com/AlessandroZ/LaZagne/">https://github.com/AlessandroZ/LaZagne/</a><br><a target="_blank" rel="noopener" href="https://github.com/huntergregal/mimipenguin">https://github.com/huntergregal/mimipenguin</a><br><a target="_blank" rel="noopener" href="https://xenarmor.com/allinone-password-recovery-pro-software/">https://xenarmor.com/allinone-password-recovery-pro-software/</a></p>
</blockquote>
<p>1.站点源码备份文件、数据库备份文件等<br>2.各类数据库Web管理入口，如PHPMyAdmin<br>3.浏览器保存密码、浏览器Cookies<br>4.其他用户会话、3389和ipc$连接记录、回收站内容<br>5.Windows 保存的WIFI密码<br>6.网络内部的各种帐号和密码，如：Email、VPN、FTP、OA等<br>利用CS抓取明文密码需要先提权<br>提权:利用CS插件<br><img src="/posts/225ec2c9/image-20220912105234985.png" alt="image-20220912105234985"><br>提权完成后抓取明文密码<br><img src="/posts/225ec2c9/image-20220912105515362.png" alt="image-20220912105515362"><br>在视图中开启密码凭证<br><img src="/posts/225ec2c9/image-20220912105555583.png" alt="image-20220912105555583"></p>
<h2 id="自动化工具探针-插件-amp-Adfind-amp-BloodHound"><a href="#自动化工具探针-插件-amp-Adfind-amp-BloodHound" class="headerlink" title="自动化工具探针-插件&amp;Adfind&amp;BloodHound"></a>自动化工具探针-插件&amp;Adfind&amp;BloodHound</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/k8gege/LadonGo">https://github.com/k8gege/LadonGo</a><br><a target="_blank" rel="noopener" href="https://github.com/BloodHoundAD/BloodHound">https://github.com/BloodHoundAD/BloodHound</a><br><a target="_blank" rel="noopener" href="http://www.joeware.net/freetools/tools/adfind/index.htm">http://www.joeware.net/freetools/tools/adfind/index.htm</a></p>
</blockquote>
<p>CS插件:LSTAR Ladon OLa TaoWu等<br>上传Adfind进行自动化信息搜集<br><img src="/posts/225ec2c9/image-20220912110250086.png" alt="image-20220912110250086"></p>
<p>Adfind常见命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出域控制器名称</span></span><br><span class="line">AdFind -sc dclist </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询当前域中在线的计算机</span></span><br><span class="line">AdFind -sc computers_active</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询当前域中在线的计算机(只显示名称和操作系统)</span></span><br><span class="line">AdFind -sc computers_active name operatingSystem</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询当前域中所有计算机</span></span><br><span class="line">AdFind -f &quot;objectcategory=computer&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询当前域中所有计算机(只显示名称和操作系统)</span></span><br><span class="line">AdFind -f &quot;objectcategory=computer&quot; name operatingSystem</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询域内所有用户</span></span><br><span class="line">AdFind -users name</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询所有GPO</span></span><br><span class="line">AdFind -sc gpodmp </span><br></pre></td></tr></table></figure>

<p><img src="/posts/225ec2c9/image-20220912123714674.png" alt="image-20220912123714674"></p>
<p>BloodHound域分析使用</p>
<blockquote>
<p>BloodHound 是一个强大的内网域渗透提权分析工具，构建于 <a target="_blank" rel="noopener" href="http://linkurio.us/">Linkurious</a> 之上。BloodHound 采用了原始的 PowerPath 概念背后的一些关键概念，并将这些概念放在一个能运行且直观，并易于使用的功能中，用于提取和分析数据，可以高效准确地显示如何提升 AD 域中的权限。它可以显示两个域中的 “域管理员” 组的有效成员。</p>
</blockquote>
<p>安装&amp;使用：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://cn-sec.com/archives/146548.html">http://cn-sec.com/archives/146548.html</a><br><a target="_blank" rel="noopener" href="https://github.com/BloodHoundAD/BloodHound">https://github.com/BloodHoundAD/BloodHound</a></p>
</blockquote>
<p>上传SharpHound.exe(\resources\app\Collectors下)到服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharpHound.exe -c all</span><br></pre></td></tr></table></figure>

<p><img src="/posts/225ec2c9/image-20220912124235379.png" alt="image-20220912124235379"></p>
<p>会生成一个压缩包</p>
<p>本地启动分析</p>
<p>1、启动neo4j 下载好后直接运行即可</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/download-center/#community">https://neo4j.com/download-center/#community</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neo4j.bat console</span><br></pre></td></tr></table></figure>

<p>启动完成到<a target="_blank" rel="noopener" href="http://localhost:7474/browser/%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81">http://localhost:7474/browser/修改密码</a></p>
<p>2、启动BloodHound 直接运行 BloodHound.exe<br>账号密码为就是neo4j的账号密码<br>3、运行程序后将生成数据导入，筛选查看<br><img src="/posts/225ec2c9/image-20220912143847126.png" alt="image-20220912143847126"><br>上传刚才生成的压缩包<br><img src="/posts/225ec2c9/image-20220912143921209.png" alt="image-20220912143921209"><br>点击左上角展开菜单<br><img src="/posts/225ec2c9/image-20220912144033107.png" alt="image-20220912144033107">	</p>
<p>Analysis为所有功能<br><img src="/posts/225ec2c9/image-20220912144311135.png" alt="image-20220912144311135"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Find all Domain Admins  #找到所有域管理员</span><br><span class="line">Find Shortest Paths to Domain Admins #找到域管理员的最短路径</span><br><span class="line">Find Principals with DCSync Rights #查找具有DCSync权限的主体</span><br><span class="line">Users with Foreign Domain Group Membership #具有外部域组成员资格的用户</span><br><span class="line">Groups with Foreign Domain Group Membership #具有外国域组成员的组</span><br><span class="line">Map Domain Trusts #映射领域信托</span><br><span class="line">Shortest Paths to Unconstrained Delegation Systems #无约束委托系统的最短路径 </span><br><span class="line">Shortest Paths from Kerberoastable Users 从kerberostabable #用户的最短路径</span><br><span class="line">Shortest Paths to Domain Admins from Kerberoastable Users #从kerberostable用户到域管理员的最短路径</span><br><span class="line">Shortest Path from Owned Principals #从所有主体出发的最短路径</span><br><span class="line">Shortest Paths to Domain Admins from Owned Principals #从所属主体到域管理员的最短路径</span><br><span class="line">Shortest Paths to High Value Targets #到高价值目标的最短路径</span><br><span class="line">Find Computers where Domain Users are Local Admin #查找域用户为本地管理员的计算机</span><br><span class="line">Find Computers where Domain Users can read LAPS passwords #查找域用户可以读取LAPS密码的计算机</span><br><span class="line">Shortest Paths from Domain Users to High Value Targets #从域用户到高价值目标的最短路径</span><br><span class="line">Find All Paths from Domain Users to High Value Targets #找到从域用户到高值目标的所有路径</span><br><span class="line">Find Workstations where Domain Users can RDP #找到域用户可以RDP的工作站</span><br><span class="line">Find Servers where Domain Users can RDP #找到域用户可以RDP的服务器</span><br><span class="line">Find Dangerous Rights for Domain Users Groups #查找域用户组的危险权限</span><br><span class="line">Find Kerberoastable Members of High Value Groups #查找高值组中可支持kerberos的成员</span><br><span class="line">List all Kerberoastable Accounts #列出所有可kerberos的帐户</span><br><span class="line">Find Kerberoastable Users with most privileges #查找具有最多特权的可支持kerberostaber的用户</span><br><span class="line">Find Domain Admin Logons to non-Domain Controllers #找到非域控制器的域管理登录</span><br><span class="line">Find Computers with Unsupported Operating Systems #查找操作系统不受支持的计算机</span><br><span class="line">Find AS-REP Roastable Users (DontReqPreAuth) #查找AS-REP烘烤用户(DontReqPreAuth)</span><br></pre></td></tr></table></figure>

<p>点击可查看详细信息<br><img src="/posts/225ec2c9/image-20220912145106437.png" alt="image-20220912145106437"></p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/posts/a28d2b5c/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
              2022-09-12 00:00:00
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="标签"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/%E5%86%85%E7%BD%91/" title="内网">
                        #内网
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-text">域信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9F%9F%E7%8E%AF%E5%A2%83"><span class="toc-text">什么是域环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E4%BF%A1%E6%81%AF%E7%B1%BB%E6%94%B6%E9%9B%86-%E5%BA%94%E7%94%A8-amp-%E6%9C%8D%E5%8A%A1-amp-%E6%9D%83%E9%99%90%E7%AD%89"><span class="toc-text">常规信息类收集-应用&amp;服务&amp;权限等</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E4%BF%A1%E6%81%AF%E7%B1%BB%E6%94%B6%E9%9B%86-%E7%BD%91%E7%BB%9C-amp-%E7%94%A8%E6%88%B7-amp-%E5%9F%9F%E6%8E%A7%E7%AD%89"><span class="toc-text">架构信息类收集-网络&amp;用户&amp;域控等</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E4%BF%A1%E6%81%AF%E7%B1%BB%E6%94%B6%E9%9B%86-%E5%AF%86%E7%A0%81-amp-%E5%87%AD%E6%8D%AE-amp-%E5%8F%A3%E4%BB%A4%E7%AD%89"><span class="toc-text">关键信息类收集-密码&amp;凭据&amp;口令等</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%E6%8E%A2%E9%92%88-%E6%8F%92%E4%BB%B6-amp-Adfind-amp-BloodHound"><span class="toc-text">自动化工具探针-插件&amp;Adfind&amp;BloodHound</span></a></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2022 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="搜索...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + %E5%9F%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86 + '&url=' + http%3A%2F%2Fexample.com%2Fposts%2F225ec2c9%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://example.com/posts/225ec2c9/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
